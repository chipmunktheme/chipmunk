{"version":3,"file":"theme.c55dd0953e669e5d68f7.hot-update.js","mappings":";;;;;;;;;;;;;;;;;;AAAA;AAEA;AACA;;AAEA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AAPA;AAWA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AAAA;AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAGA;;AAGA;AACA;;AAGA;AACA;AACA;;AAGA;;;AAGA;AACA;;AAGA;AACA;AAAA;AAAA;;AACA;AACA;AACA;;AAGA;;AAGA;AACA;AACA;AACA;AAEA;AACA;;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAdA;AAiBA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AAjDA;AA7GA;AAkKA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACpKA","sources":["webpack://chipmunk/./resources/scripts/modules/actions.js","webpack://chipmunk/webpack/runtime/getFullHash"],"sourcesContent":["import axios from 'axios';\n\nconst Actions = {\n  http: null,\n\n  init(element = document) {\n    const { ajaxUrl, loginUrl } = window;\n\n    this.settings = { ajaxUrl, loginUrl };\n    this.triggers = Array.from(element.querySelectorAll('[data-action]:not([data-type])'));\n\n    this.http = axios.create({\n      transformRequest: [\n        (data) => {\n          // Prefix the action name\n          data.set('action', `chipmunk_${data.get('action')}`);\n\n          return data;\n        },\n      ],\n    });\n\n    this.triggers.forEach((trigger) => {\n      if (!trigger.dataset.listening) {\n        if (trigger.hasAttribute('action')) {\n          trigger.addEventListener('submit', this.handleEvent.bind(this));\n        } else {\n          trigger.addEventListener('click', this.handleEvent.bind(this));\n        }\n\n        // Only bind the event once on this element\n        trigger.dataset.listening = true;\n      }\n    });\n  },\n\n  handleEvent(ev, trigger) {\n    if (ev) {\n      if (!trigger) {\n        trigger = ev.currentTarget;\n      }\n\n      ev.preventDefault();\n      ev.stopPropagation();\n    }\n\n    this.runActions(trigger, [{ data: trigger.dataset }]);\n  },\n\n  runActions(trigger, actions) {\n    const requests = [];\n\n    if (actions && actions.length) {\n      // Enable loading indicator\n      trigger.classList.add('is-loading');\n\n      // Disable the current trigger\n      trigger.setAttribute('disabled', true);\n\n      // Loop through the actions provided\n      actions.forEach((action) => {\n        const formData = new FormData(trigger.hasAttribute('action') ? trigger : document.createElement('form'));\n\n        // Extend formData with trigger data attributes\n        Object.keys(action.data).forEach((key) => {\n          formData.append(key, action.data[key]);\n        });\n\n        // Assign callback function\n        action.callback = action.callback || this.callbacks[action.data.action] || (() => {});\n\n        // Assign new request\n        requests.push(this.http.post(this.settings.ajaxUrl, formData));\n      });\n\n      // Run concurrent action\n      axios.all(requests).then(\n        axios.spread((...args) => {\n          args.forEach((arg, index) => {\n            setTimeout(() => {\n              actions[index].callback(trigger, arg.data, actions[index].data.action);\n\n              // Disable loading indicator\n              trigger.classList.remove('is-loading');\n\n              // Enable the current trigger\n              trigger.removeAttribute('disabled');\n            }, 250);\n          });\n        }),\n      );\n    }\n  },\n\n  handlers: {\n    toggle: (trigger, { success, data }, action) => {\n      if (success) {\n        const targets = document.querySelectorAll(`[data-action=\"${action}\"][data-action-post-id=\"${data.post}\"]`);\n\n        targets.forEach((target) => {\n          target.classList[data.status]('is-active');\n          target.innerHTML = data.content;\n        });\n      } else {\n        if (this.settings.loginUrl) {\n          window.location = this.settings.loginUrl;\n        }\n      }\n    },\n  },\n\n  callbacks: {\n    submit_resource: (trigger, { success, data }, action) => {\n      const element = trigger.querySelector(`[data-action-element=${action}]`);\n      const message = trigger.querySelector(`[data-action-message=${action}]`);\n\n      if (message) {\n        message.style.display = null;\n        message.dataset.status = success ? 'success' : 'error';\n        message.innerHTML = data;\n\n        if (success) {\n          element.style.display = 'none';\n        }\n      }\n    },\n\n    load_posts: (trigger, { success, data }, action) => {\n      const element = document.querySelector(`[data-action-element=${action}]`);\n\n      if (element) {\n        if (success) {\n          element.insertAdjacentHTML('beforeend', data);\n          trigger.dataset.page = parseInt(trigger.dataset.page, 10) + 1;\n        } else {\n          trigger.parentNode.insertAdjacentHTML('beforeend', `<p class=\"l-header__copy\">${data}</p>`);\n          trigger.parentNode.removeChild(trigger);\n        }\n\n        // Rebind actions listeners\n        Actions.init(element);\n      }\n    },\n\n    toggle_bookmark: (trigger, response, action) => {\n      Actions.handlers.toggle(trigger, response, action);\n    },\n\n    toggle_upvote: (trigger, response, action) => {\n      Actions.handlers.toggle(trigger, response, action);\n    },\n\n    submit_rating: (trigger, { success, data }) => {\n      const element = document.querySelector(`[data-action-rating=\"${data.post}\"]`);\n\n      if (element) {\n        if (success) {\n          element.innerHTML = data.content;\n        }\n      }\n    },\n  },\n};\n\nexport default Actions;\n","__webpack_require__.h = () => (\"7527262387514c390b0f\")"],"names":[],"sourceRoot":""}