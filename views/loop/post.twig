{% set layout = is_single or is_front_page ? 'tiles' : get_option('blog_layout') %}

{% if is_singular('post') %}
  {% set posts = get_related(post.id) %}
{% endif %}

{% if is_singular('page') %}
  {% set title = post.title %}
{% elseif is_singular('post') %}
  {% set title = __('Related', 'chipmunk') %}
{% elseif is_front_page %}
  {% set title = __('Latest Posts', 'chipmunk') %}
{% else %}
  {% set title = __('Blog', 'chipmunk') %}
{% endif %}

{% if (not is_front_page and not is_single) or posts %}
  <div class="l-section">
    <div class="l-container">
      {% if (title and layout == 'tiles') or not posts %}
        <div class="l-component l-header">
          {% if title %}
            <h2 class="{{ cn('c-heading', 'h4') }}">{{ title }}</h2>
          {% endif %}

          {% if not posts %}
            <p class="l-header__copy">
              {{ __('Sorry, there are no posts to display yet.', 'chipmunk') }}
            </p>
          {% endif %}
        </div>
      {% endif %}

      {% if posts %}
        <div class="l-component">
          <div class="{{ cn('c-tile__list', 'separated') }}" data-action-element="load_posts">
            {% for post in posts %}
              {% if layout == 'excerpts' or (layout == 'mixed' and loop.index0 % 4 == 0 and posts.pagination.current == 1) %}
                {% include "excerpt/#{ post.type }.twig" %}
              {% else %}
                {% include "tile/#{ post.type }.twig" %}
              {% endif %}
            {% endfor %}
          </div>
        </div>
      {% endif %}

      {% if not is_front_page and not is_single %}
        {% include 'sections/pagination.twig' with { pagination: posts.pagination } %}
      {% endif %}
    </div>
  </div>
{% endif %}
